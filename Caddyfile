# Caddyfile for ECEEE v4 Production
# Caddy automatically handles HTTPS/TLS certificates via Let's Encrypt

{
    # Global options
    email {$EMAIL:noreply@localhost}
}

# Main site
{$DOMAIN:localhost} {
    # Enable compression
    encode gzip
    
    # Static files (must come first, no trailing slash handling)
    handle_path /static/* {
        reverse_proxy backend:8000
    }
    
    # Media files (must come first, no trailing slash handling)
    handle_path /media/* {
        reverse_proxy backend:8000
    }
    
    # Django admin
    handle /admin* {
        reverse_proxy backend:8000
    }
    
    # API
    handle /api/* {
        reverse_proxy backend:8000
    }
    
    # Frontend (default)
    handle /* {
        reverse_proxy frontend:80
    }
}

