{% load webpages_tags %}
<div class="two-columns-widget widget-{{ widget.id|default:'unknown' }}" 
     data-widget-type="two-columns"
     data-widget-id="{{ widget.id|default:'unknown' }}">
    
    <!-- Left Column -->
    <div class="column-slot left" data-slot="left">
        {% if config.rendered_slots.left %}
            {% for widget_info in config.rendered_slots.left %}
                <div class="widget-wrapper">
                    {% if widget_info.html %}
                        {{ widget_info.html|safe }}
                    {% else %}
                        {# Fallback rendering for widget_data #}
                        {% with widget_data=widget_info.widget_data %}
                            {% if widget_data.type == "core_widgets.ContentWidget" %}
                                <div class="content-widget">
                                    {{ widget_data.configuration.content|default:widget_data.config.content|safe }}
                                </div>
                            {% elif widget_data.type == "core_widgets.ImageWidget" %}
                                <div class="image-widget">
                                    {% for media_item in widget_data.configuration.mediaItems|default:widget_data.config.mediaItems %}
                                        <img src="{{ media_item.url }}" alt="{{ media_item.altText }}" />
                                        {% if media_item.caption %}
                                            <p class="image-caption">{{ media_item.caption }}</p>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="generic-widget" data-widget-type="{{ widget_data.type }}">
                                    <p><strong>{{ widget_data.type }} Widget</strong></p>
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-slot">Left column</div>
        {% endif %}
    </div>
    
    <!-- Right Column -->
    <div class="column-slot right" data-slot="right">
        {% if config.rendered_slots.right %}
            {% for widget_info in config.rendered_slots.right %}
                <div class="widget-wrapper">
                    {% if widget_info.html %}
                        {{ widget_info.html|safe }}
                    {% else %}
                        {# Fallback rendering for widget_data #}
                        {% with widget_data=widget_info.widget_data %}
                            {% if widget_data.type == "core_widgets.ContentWidget" %}
                                <div class="content-widget">
                                    {{ widget_data.configuration.content|default:widget_data.config.content|safe }}
                                </div>
                            {% elif widget_data.type == "core_widgets.ImageWidget" %}
                                <div class="image-widget">
                                    {% for media_item in widget_data.configuration.mediaItems|default:widget_data.config.mediaItems %}
                                        <img src="{{ media_item.url }}" alt="{{ media_item.altText }}" />
                                        {% if media_item.caption %}
                                            <p class="image-caption">{{ media_item.caption }}</p>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="generic-widget" data-widget-type="{{ widget_data.type }}">
                                    <p><strong>{{ widget_data.type }} Widget</strong></p>
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-slot">Right column</div>
        {% endif %}
    </div>
</div>
