{% load static %}
{% load imgproxy_tags %}

{# Only render if there's content or images #}
{% if config.content or config.image_1 or config.image_2 or config.image_3 or config.image_4 %}

{% if custom_style_css %}
<style>{{ custom_style_css|safe }}</style>
{% endif %}

<div class="banner-widget widget-type-{{ widget_type.css_class_name }} cms-content"{% if config.anchor %} id="{{ config.anchor }}"{% endif %}>
    {# Background image if provided - full width #}
    {% if config.background_image %}
        <div class="banner-background" style="background-image: url('{% imgproxy config.background_image width=1920 height=600 resize_type='fill' %}');"></div>
    {% endif %}

    <div class="banner-body text-{{ config.text_position|default:'left' }} image-count-{{ config.image_count|default:1 }}">
        {% if config.image_count == 4 %}
            {# 4 images layout - no text, just images in a row #}
            {# Default: 400x400 square images, 2x: 800x800 #}
            <div class="banner-images layout-4">
                {% if config.image_1 %}
                    <img 
                        class="banner-image"
                        src="{% imgproxy config.image_1 width=400 height=400 resize_type='fill' %}"
                        srcset="{% imgproxy config.image_1 width=400 height=400 resize_type='fill' %} 1x, {% imgproxy config.image_1 width=800 height=800 resize_type='fill' %} 2x"
                        alt="" />
                {% endif %}
                {% if config.image_2 %}
                    <img 
                        class="banner-image"
                        src="{% imgproxy config.image_2 width=400 height=400 resize_type='fill' %}"
                        srcset="{% imgproxy config.image_2 width=400 height=400 resize_type='fill' %} 1x, {% imgproxy config.image_2 width=800 height=800 resize_type='fill' %} 2x"
                        alt="" />
                {% endif %}
                {% if config.image_3 %}
                    <img 
                        class="banner-image"
                        src="{% imgproxy config.image_3 width=400 height=400 resize_type='fill' %}"
                        srcset="{% imgproxy config.image_3 width=400 height=400 resize_type='fill' %} 1x, {% imgproxy config.image_3 width=800 height=800 resize_type='fill' %} 2x"
                        alt="" />
                {% endif %}
                {% if config.image_4 %}
                    <img 
                        class="banner-image"
                        src="{% imgproxy config.image_4 width=400 height=400 resize_type='fill' %}"
                        srcset="{% imgproxy config.image_4 width=400 height=400 resize_type='fill' %} 1x, {% imgproxy config.image_4 width=800 height=800 resize_type='fill' %} 2x"
                        alt="" />
                {% endif %}
            </div>
        {% else %}
            {# 1 or 2 images layout - with text #}
            <div class="banner-text">
                {{ config.content|safe }}
            </div>
            
            <div class="banner-images layout-{{ config.image_count|default:1 }}">
                {% if config.image_1 %}
                    {% if config.image_count == 1 %}
                        {# Single image - square 600x600, 2x: 1200x1200 #}
                        <img 
                            class="banner-image"
                            src="{% imgproxy config.image_1 width=600 height=600 resize_type='fill' %}"
                            srcset="{% imgproxy config.image_1 width=600 height=600 resize_type='fill' %} 1x, {% imgproxy config.image_1 width=1200 height=1200 resize_type='fill' %} 2x"
                            alt="" />
                    {% else %}
                        {# Two images - portrait 400x600, 2x: 800x1200 #}
                        <img 
                            class="banner-image"
                            src="{% imgproxy config.image_1 width=400 height=600 resize_type='fill' %}"
                            srcset="{% imgproxy config.image_1 width=400 height=600 resize_type='fill' %} 1x, {% imgproxy config.image_1 width=800 height=1200 resize_type='fill' %} 2x"
                            alt="" />
                    {% endif %}
                {% endif %}
                {% if config.image_2 and config.image_count >= 2 %}
                    {# Second image - portrait 400x600, 2x: 800x1200 #}
                    <img 
                        class="banner-image"
                        src="{% imgproxy config.image_2 width=400 height=600 resize_type='fill' %}"
                        srcset="{% imgproxy config.image_2 width=400 height=600 resize_type='fill' %} 1x, {% imgproxy config.image_2 width=800 height=1200 resize_type='fill' %} 2x"
                        alt="" />
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

{% endif %}{# End check for empty banner #}
