{% load static %}

<nav 
    class="navbar-widget" 
    style="{{ navbar_style }} position: relative;"
    x-data="{
        isMobileMenuOpen: false,
        isOverflowMenuOpen: false,
        showHamburger: window.innerWidth < {{ config.hamburger_breakpoint|default:768 }},
        hamburgerBreakpoint: {{ config.hamburger_breakpoint|default:768 }},
        init() {
            this.$watch('showHamburger', () => {
                this.isMobileMenuOpen = false;
                this.isOverflowMenuOpen = false;
            });
        }
    }"
    x-init="
        window.addEventListener('resize', () => {
            showHamburger = window.innerWidth < hamburgerBreakpoint;
        });
    "
    @click.away="isOverflowMenuOpen = false; isMobileMenuOpen = false"
>
    <!-- Hamburger menu mode (mobile) -->
    <div x-show="showHamburger" class="navbar-hamburger-mode" style="display: flex; align-items: center; height: 100%; padding: 0 20px; justify-content: space-between;">
        <button 
            @click="isMobileMenuOpen = !isMobileMenuOpen"
            style="color: white; background: none; border: none; cursor: pointer; padding: 4px; display: flex; align-items: center;"
            aria-label="Toggle menu"
        >
            <svg x-show="!isMobileMenuOpen" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
            <svg x-show="isMobileMenuOpen" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>

    <!-- Mobile slide-out menu -->
    <div 
        x-show="showHamburger && isMobileMenuOpen" 
        x-transition
        style="position: absolute; top: 100%; left: 0; width: 16rem; background: white; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); z-index: 50; border: 1px solid #e5e7eb;"
    >
        <div style="padding: 0.5rem 0;">
            <!-- Primary menu items -->
            {% for item in config.menu_items %}
                <a 
                    href="{{ item.url }}"
                    {% if item.target_blank %}target="_blank" rel="noopener noreferrer"{% endif %}
                    @click="isMobileMenuOpen = false"
                    style="display: block; padding: 0.5rem 1rem; font-size: 0.875rem; color: #374151; text-decoration: none; transition: background-color 0.2s;"
                    onmouseover="this.style.backgroundColor='#f3f4f6'"
                    onmouseout="this.style.backgroundColor='transparent'"
                >
                    {{ item.label }}
                </a>
            {% endfor %}

            <!-- Secondary menu items -->
            {% if config.secondary_menu_items %}
                <div style="border-top: 1px solid #e5e7eb; margin-top: 0.5rem; padding-top: 0.5rem;">
                    {% for item in config.secondary_menu_items %}
                        <a 
                            href="{{ item.url }}"
                            {% if item.target_blank %}target="_blank" rel="noopener noreferrer"{% endif %}
                            @click="isMobileMenuOpen = false"
                            style="
                                display: block; 
                                padding: 0.5rem 1rem; 
                                font-size: 0.875rem; 
                                color: #ffffff;
                                text-decoration: none; 
                                transition: opacity 0.2s;
                                margin: 0.25rem 0.5rem;
                                border-radius: 4px;
                                {% if item.background_color %}background-color: {{ item.background_color }};{% else %}background-color: #3b82f6;{% endif %}
                                {% if item.background_image %}
                                    background-image: url('{{ item.background_image.imgproxy_base_url|default:item.background_image }}');
                                    background-size: cover;
                                    background-position: center;
                                    background-repeat: no-repeat;
                                {% endif %}
                            "
                            onmouseover="this.style.opacity='0.8'"
                            onmouseout="this.style.opacity='1'"
                        >
                            {{ item.label }}
                        </a>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Desktop mode with overflow menu -->
    <div x-show="!showHamburger" style="position: relative; display: flex; justify-content: space-between; align-items: center; height: 28px; width: 100%;">
        <!-- Primary menu (left-aligned) -->
        <ul style="display: flex; gap: 1.5rem; list-style: none; margin: 0; padding: 0 0 0 20px; align-items: center;">
            {% for item in config.menu_items %}
                <li>
                    <a 
                        href="{{ item.url }}"
                        {% if item.target_blank %}target="_blank" rel="noopener noreferrer"{% endif %}
                        style="color: #ffffff; font-size: 0.875rem; font-weight: 500; text-decoration: none; transition: opacity 0.2s ease-in-out; white-space: nowrap;"
                        onmouseover="this.style.opacity='0.8'"
                        onmouseout="this.style.opacity='1'"
                    >
                        {{ item.label }}
                    </a>
                </li>
            {% endfor %}

            <!-- Overflow menu button (shown via CSS/JS when needed) -->
            <!-- Note: Full overflow detection requires JavaScript measurement -->
            <!-- This is a simplified version; full implementation matches React component -->
        </ul>

        <!-- Secondary menu (right-aligned) -->
        {% if config.secondary_menu_items %}
        <ul 
            style="display: flex; gap: 0.25rem; list-style: none; margin: 0; padding: 0 20px 0 0; align-items: center;"
            x-data="{ secondaryMenuVisible: true }"
        >
            {% for item in config.secondary_menu_items %}
                <li x-show="secondaryMenuVisible">
                    <a 
                        href="{{ item.url }}"
                        {% if item.target_blank %}target="_blank" rel="noopener noreferrer"{% endif %}
                        style="
                            color: #ffffff; 
                            font-size: 0.875rem; 
                            font-weight: 500; 
                            text-decoration: none; 
                            transition: opacity 0.2s ease-in-out; 
                            white-space: nowrap;
                            padding: 4px 12px;
                            display: inline-block;
                            border-radius: 4px;
                            {% if item.background_color %}background-color: {{ item.background_color }};{% endif %}
                            {% if item.background_image %}
                                background-image: url('{{ item.background_image.imgproxy_base_url|default:item.background_image }}');
                                background-size: cover;
                                background-position: center;
                                background-repeat: no-repeat;
                            {% endif %}
                        "
                        onmouseover="this.style.opacity='0.8'"
                        onmouseout="this.style.opacity='1'"
                    >
                        {{ item.label }}
                    </a>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
</nav>

